; Universidad del Valle de Guatemala ; IE2023: Programación de Microcontroladores
; Lab3.asm
; Autor: Diego Duarte 22426
; Proyecto: Laboratorio 2
; Hardware: ATMEGA328P
; Creado: 14/02/2024
; Última modificación: 14/02/2024

.include "M328PDEF.inc"
.CSEG
.DEF VALOR_LEDS = R18
.ORG 0x0000
	JMP MAIN

.ORG 0X0008
	JMP ISR_PCINT1

MAIN:
	LDI R16, LOW(RAMEND)
	OUT SPL, R16
	LDI R17, HIGH(RAMEND)
	OUT SPH, R17

SETUP:
	LDI R16, (1 << CLKPCE)
	STS CLKPR, R16

	LDI R16, 0b0000_0011
	STS CLKPR, R16

	LDI R16, 0b0001_1110
	OUT DDRB, R16

	LDI R16, 0b0000_0011
	OUT PORTC, R16

	LDI R16, 0x00
	OUT DDRC, R16

	LDI R16, (1 << PCINT8)|(1 << PCINT9)
	STS PCMSK1, R16

	LDI R16, (1 << PCIE1)
	STS PCICR, R16

	//LDI R16, (1 << PCIF1)

	LDI VALOR_LEDS, 0x00

	SEI

LOOP:
	MOV R16, R18
	LSL R16
	ANDI R16, 0b0001_1110
	OUT PORTB, R16

	RJMP LOOP



ISR_PCINT1:
	PUSH R16
	IN R16, SREG
	PUSH R16

	IN  R16, PINC
	SBRC R16, PC0
	RJMP CHECK_SUMA
RESTA:
	DEC R18
	RJMP CONTINUE
CHECK_SUMA:
	SBRC R16, PC1
	RJMP CONTINUE
SUMA:
	INC R18
CONTINUE:

	POP R16
	OUT SREG, R16
	POP R16
	RETI
	